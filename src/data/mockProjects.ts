import { Project, TestCase, TestStep, ProjectMember } from '@/types';

const createMembers = (): ProjectMember[] => [
  { id: 'm1', name: 'Sarah Chen', email: 'sarah.chen@amazon.com', role: 'owner' },
  { id: 'm2', name: 'Marcus Johnson', email: 'marcus.j@amazon.com', role: 'edit' },
  { id: 'm3', name: 'Emily Rodriguez', email: 'emily.r@amazon.com', role: 'edit' },
  { id: 'm4', name: 'David Kim', email: 'david.kim@amazon.com', role: 'view' },
  { id: 'm5', name: 'Lisa Thompson', email: 'lisa.t@amazon.com', role: 'view' },
];

const createSteps = (stepDescriptions: string[], failedStep?: number, failureReason?: string): TestStep[] => {
  return stepDescriptions.map((desc, index) => ({
    id: `step-${index + 1}`,
    stepNumber: index + 1,
    description: desc,
    status: failedStep === index + 1 ? 'failed' : (failedStep && index + 1 > failedStep ? 'pending' : 'passed'),
    failureReason: failedStep === index + 1 ? failureReason : undefined,
    duration: Math.random() * 5 + 1,
  }));
};

const cartPageTestCases: TestCase[] = [
  {
    id: 'tc-cart-1',
    name: 'Add Single Item to Cart',
    description: 'Verify user can add a single product to cart from PDP',
    steps: createSteps([
      'Navigate to Amazon.com homepage',
      'Search for "wireless headphones"',
      'Click on first search result',
      'Verify product detail page loads correctly',
      'Select product options (color, size if applicable)',
      'Click "Add to Cart" button',
      'Verify success toast appears',
      'Verify cart badge count increments to 1',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 3600000),
    duration: 42.3,
    assertions: [],
  },
  {
    id: 'tc-cart-2',
    name: 'Add Multiple Items to Cart',
    description: 'Verify cart correctly handles multiple different products',
    steps: createSteps([
      'Login as test user',
      'Add first product to cart',
      'Navigate back to homepage',
      'Search for second product',
      'Add second product to cart',
      'Navigate to cart page',
      'Verify both items are displayed',
      'Verify cart total is correct',
      'Verify quantity selectors work correctly',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 7200000),
    duration: 58.7,
    assertions: [],
  },
  {
    id: 'tc-cart-3',
    name: 'Update Cart Quantity',
    description: 'Test quantity updates in cart with price recalculation',
    steps: createSteps([
      'Add product to cart',
      'Navigate to cart page',
      'Locate quantity dropdown',
      'Change quantity from 1 to 3',
      'Wait for page to update',
      'Verify quantity reflects 3 items',
      'Verify subtotal is recalculated correctly',
    ], 5, 'Timeout: Price did not update within 10 seconds after quantity change'),
    status: 'failed',
    lastRun: new Date(Date.now() - 1800000),
    duration: 35.2,
    assertions: [],
    failedStepSummary: 'Step 5 failed: Timeout waiting for price recalculation after quantity update',
  },
  {
    id: 'tc-cart-4',
    name: 'Remove Item from Cart',
    description: 'Verify item removal updates cart correctly',
    steps: createSteps([
      'Add two products to cart',
      'Navigate to cart page',
      'Click "Delete" on first item',
      'Confirm deletion if prompted',
      'Verify item is removed',
      'Verify cart count decrements',
      'Verify remaining item total is correct',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 5400000),
    duration: 28.9,
    assertions: [],
  },
  {
    id: 'tc-cart-5',
    name: 'Save for Later Functionality',
    description: 'Test moving items between cart and saved items',
    steps: createSteps([
      'Add product to cart',
      'Navigate to cart page',
      'Click "Save for later"',
      'Verify item moves to Saved section',
      'Verify cart is empty',
      'Click "Move to cart" on saved item',
      'Verify item returns to cart',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 9000000),
    duration: 45.6,
    assertions: [],
  },
  {
    id: 'tc-cart-6',
    name: 'Apply Promo Code',
    description: 'Verify promo code application and discount calculation',
    steps: createSteps([
      'Add eligible product to cart',
      'Navigate to cart page',
      'Locate promo code input field',
      'Enter valid promo code "SAVE10"',
      'Click Apply button',
      'Verify discount is applied',
      'Verify order summary reflects discount',
      'Verify savings message is displayed',
    ]),
    status: 'running',
    lastRun: new Date(),
    assertions: [],
  },
  {
    id: 'tc-cart-7',
    name: 'Cart Persistence After Logout',
    description: 'Verify cart items persist after user logs out and back in',
    steps: createSteps([
      'Login as registered user',
      'Add 3 items to cart',
      'Logout from account',
      'Login again with same credentials',
      'Navigate to cart',
      'Verify all 3 items are present',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 12000000),
    duration: 67.3,
    assertions: [],
  },
  {
    id: 'tc-cart-8',
    name: 'Guest Cart Merge on Login',
    description: 'Test cart merging when guest user logs in',
    steps: createSteps([
      'As guest, add product A to cart',
      'Click login button',
      'Login with account that has product B in cart',
      'Verify both products A and B are in cart',
      'Verify no duplicates if same product',
      'Verify quantities are combined correctly',
    ]),
    status: 'pending',
    assertions: [],
  },
  {
    id: 'tc-cart-9',
    name: 'Out of Stock Item Handling',
    description: 'Verify cart behavior when item becomes unavailable',
    steps: createSteps([
      'Add limited stock item to cart',
      'Wait for stock to deplete (simulated)',
      'Refresh cart page',
      'Verify out of stock warning appears',
      'Verify checkout button behavior',
      'Test removal of out of stock item',
    ], 4, 'Assertion failed: Expected "Out of Stock" warning not displayed'),
    status: 'failed',
    lastRun: new Date(Date.now() - 3600000),
    duration: 41.2,
    assertions: [],
    failedStepSummary: 'Step 4 failed: Out of stock warning message not rendered correctly',
  },
  {
    id: 'tc-cart-10',
    name: 'Cart Price Update on Sale',
    description: 'Verify cart reflects real-time price changes',
    steps: createSteps([
      'Add item with regular price to cart',
      'Trigger flash sale (via test API)',
      'Refresh cart page',
      'Verify new sale price is shown',
      'Verify savings are displayed',
      'Verify original price is struck through',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 18000000),
    duration: 33.8,
    assertions: [],
  },
];

const signupFlowTestCases: TestCase[] = [
  {
    id: 'tc-signup-1',
    name: 'New Customer Email Registration',
    description: 'Complete signup flow for new customer using email',
    steps: createSteps([
      'Navigate to Amazon.com homepage',
      'Click "Hello, Sign in" dropdown',
      'Click "Start here" new customer link',
      'Enter valid name',
      'Enter unique email address',
      'Enter password meeting requirements',
      'Confirm password',
      'Click "Create your Amazon account"',
      'Verify confirmation email is sent',
      'Click verification link in email',
      'Verify account is activated',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 4800000),
    duration: 89.5,
    assertions: [],
  },
  {
    id: 'tc-signup-2',
    name: 'Phone Number Registration',
    description: 'Signup using mobile phone number instead of email',
    steps: createSteps([
      'Navigate to registration page',
      'Click "Use phone number instead"',
      'Enter valid mobile number',
      'Request OTP',
      'Enter received OTP',
      'Complete profile details',
      'Verify account creation success',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 7200000),
    duration: 72.3,
    assertions: [],
  },
  {
    id: 'tc-signup-3',
    name: 'Password Validation Rules',
    description: 'Test all password requirement validations',
    steps: createSteps([
      'Navigate to signup page',
      'Enter password less than 6 chars',
      'Verify minimum length error',
      'Enter password without numbers',
      'Verify complexity error',
      'Enter valid password',
      'Verify password strength indicator',
      'Submit form successfully',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 9600000),
    duration: 45.8,
    assertions: [],
  },
  {
    id: 'tc-signup-4',
    name: 'Duplicate Email Prevention',
    description: 'Verify system prevents duplicate account creation',
    steps: createSteps([
      'Navigate to signup page',
      'Enter already registered email',
      'Complete other form fields',
      'Submit registration form',
      'Verify duplicate email error message',
      'Verify link to login page is shown',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 14400000),
    duration: 28.4,
    assertions: [],
  },
  {
    id: 'tc-signup-5',
    name: 'Social Login - Google',
    description: 'Test Google OAuth signup integration',
    steps: createSteps([
      'Navigate to signup page',
      'Click "Continue with Google"',
      'Select Google account from popup',
      'Grant permissions',
      'Verify redirect back to Amazon',
      'Verify account created with Google email',
      'Verify profile picture imported',
    ], 4, 'OAuth Error: Google authentication popup blocked by browser'),
    status: 'failed',
    lastRun: new Date(Date.now() - 2400000),
    duration: 15.2,
    assertions: [],
    failedStepSummary: 'Step 4 failed: OAuth popup was blocked, unable to complete Google authentication',
  },
  {
    id: 'tc-signup-6',
    name: 'Social Login - Apple',
    description: 'Test Apple Sign In integration',
    steps: createSteps([
      'Navigate to signup page',
      'Click "Sign in with Apple"',
      'Enter Apple ID credentials',
      'Choose email sharing preference',
      'Complete Apple authentication',
      'Verify account created successfully',
    ]),
    status: 'pending',
    assertions: [],
  },
  {
    id: 'tc-signup-7',
    name: 'CAPTCHA Verification',
    description: 'Test CAPTCHA challenge during suspicious signup',
    steps: createSteps([
      'Trigger rate limiting (multiple attempts)',
      'Verify CAPTCHA appears',
      'Solve CAPTCHA correctly',
      'Verify signup proceeds',
      'Test incorrect CAPTCHA response',
      'Verify error handling',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 21600000),
    duration: 52.1,
    assertions: [],
  },
  {
    id: 'tc-signup-8',
    name: 'Terms and Conditions Acceptance',
    description: 'Verify T&C must be acknowledged before signup',
    steps: createSteps([
      'Navigate to signup page',
      'Fill all required fields',
      'Attempt submit without T&C checked',
      'Verify validation error',
      'Check T&C checkbox',
      'Verify T&C link opens modal/page',
      'Submit successfully',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 28800000),
    duration: 38.9,
    assertions: [],
  },
  {
    id: 'tc-signup-9',
    name: 'Accessibility Compliance',
    description: 'Verify signup form meets WCAG 2.1 AA standards',
    steps: createSteps([
      'Run axe accessibility scan',
      'Verify all inputs have labels',
      'Test keyboard navigation',
      'Verify focus indicators',
      'Test screen reader compatibility',
      'Check color contrast ratios',
      'Verify error messages are accessible',
      'Test with zoom at 200%',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 36000000),
    duration: 95.4,
    assertions: [],
  },
  {
    id: 'tc-signup-10',
    name: 'Mobile Responsive Signup',
    description: 'Test signup flow on mobile viewport',
    steps: createSteps([
      'Set viewport to 375x812 (iPhone)',
      'Navigate to signup page',
      'Verify form layout is mobile-friendly',
      'Test touch input fields',
      'Verify keyboard type for email field',
      'Complete signup on mobile',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 43200000),
    duration: 48.7,
    assertions: [],
  },
  {
    id: 'tc-signup-11',
    name: 'Email Verification Expiry',
    description: 'Test behavior when verification link expires',
    steps: createSteps([
      'Create new account',
      'Wait for verification link to expire (simulated)',
      'Click expired verification link',
      'Verify expiry message shown',
      'Request new verification email',
      'Verify new link works',
    ]),
    status: 'self-healed',
    lastRun: new Date(Date.now() - 50400000),
    duration: 78.2,
    selfHealed: true,
    assertions: [],
  },
  {
    id: 'tc-signup-12',
    name: 'Business Account Registration',
    description: 'Test Amazon Business account signup flow',
    steps: createSteps([
      'Navigate to Amazon Business signup',
      'Enter business email',
      'Enter company details',
      'Enter tax ID information',
      'Upload business verification docs',
      'Submit for review',
      'Verify pending approval status',
    ]),
    status: 'running',
    lastRun: new Date(),
    assertions: [],
  },
  {
    id: 'tc-signup-13',
    name: 'Multi-language Signup',
    description: 'Verify signup works with different locale settings',
    steps: createSteps([
      'Set browser language to Spanish',
      'Navigate to signup page',
      'Verify page is translated',
      'Complete signup in Spanish',
      'Verify confirmation email in Spanish',
      'Change language to English',
      'Verify dashboard language changes',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 57600000),
    duration: 62.3,
    assertions: [],
  },
  {
    id: 'tc-signup-14',
    name: 'Prime Trial Upsell',
    description: 'Test Prime trial offer during signup',
    steps: createSteps([
      'Complete basic signup',
      'Verify Prime trial offer modal',
      'Click "Start free trial"',
      'Enter payment method',
      'Confirm trial activation',
      'Verify Prime badge on account',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 64800000),
    duration: 55.8,
    assertions: [],
  },
  {
    id: 'tc-signup-15',
    name: 'Session Recovery',
    description: 'Test signup continuation after browser crash',
    steps: createSteps([
      'Start signup process',
      'Fill partial form data',
      'Simulate browser crash',
      'Reopen browser',
      'Navigate back to signup',
      'Verify form data is preserved',
      'Complete signup',
    ]),
    status: 'pending',
    assertions: [],
  },
];

const splashPageTestCases: TestCase[] = [
  {
    id: 'tc-splash-1',
    name: 'Splash Page Load Performance',
    description: 'Verify splash page loads within acceptable time',
    steps: createSteps([
      'Clear browser cache',
      'Navigate to splash page URL',
      'Start performance timer',
      'Wait for page fully loaded',
      'Record Time to First Byte (TTFB)',
      'Record Largest Contentful Paint (LCP)',
      'Verify LCP under 2.5 seconds',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 3600000),
    duration: 12.4,
    assertions: [],
  },
  {
    id: 'tc-splash-2',
    name: 'Hero Banner Carousel',
    description: 'Test hero carousel auto-rotation and controls',
    steps: createSteps([
      'Navigate to splash page',
      'Verify first slide is visible',
      'Wait 5 seconds for auto-rotation',
      'Verify second slide appears',
      'Click previous arrow',
      'Verify first slide returns',
      'Click pagination dot 3',
      'Verify third slide displays',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 7200000),
    duration: 28.9,
    assertions: [],
  },
  {
    id: 'tc-splash-3',
    name: 'Monthly vs Annual Toggle',
    description: 'Validate plan toggle changes displayed prices and highlights',
    steps: createSteps([
      'Navigate to splash page pricing section',
      'Verify Monthly tab is default selected',
      'Verify monthly prices are displayed',
      'Click Annual toggle',
      'Verify Annual tab changes color/highlight',
      'Verify prices update to annual rates',
      'Verify savings badge appears',
      'Click Monthly toggle again',
      'Verify prices revert to monthly',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 1800000),
    duration: 18.5,
    assertions: [],
  },
  {
    id: 'tc-splash-4',
    name: 'Dynamic Content Personalization',
    description: 'Test personalized content for logged-in users',
    steps: createSteps([
      'Login as returning customer',
      'Navigate to splash page',
      'Verify personalized greeting',
      'Verify recommended products section',
      'Verify recently viewed items',
      'Logout and refresh',
      'Verify generic content displays',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 10800000),
    duration: 35.2,
    assertions: [],
  },
  {
    id: 'tc-splash-5',
    name: 'CTA Button Functionality',
    description: 'Verify all Call-to-Action buttons work correctly',
    steps: createSteps([
      'Navigate to splash page',
      'Click "Shop Now" button',
      'Verify navigation to correct category',
      'Go back to splash page',
      'Click "Learn More" button',
      'Verify modal or info section opens',
      'Click "Sign Up" CTA',
      'Verify redirect to registration',
    ], 6, 'Element not found: Learn More modal failed to open'),
    status: 'failed',
    lastRun: new Date(Date.now() - 5400000),
    duration: 22.8,
    assertions: [],
    failedStepSummary: 'Step 6 failed: "Learn More" modal component not found after click event',
  },
  {
    id: 'tc-splash-6',
    name: 'Video Background Playback',
    description: 'Test background video loads and plays correctly',
    steps: createSteps([
      'Navigate to splash page',
      'Verify video element is present',
      'Verify video starts playing automatically',
      'Verify video is muted by default',
      'Test unmute functionality',
      'Verify video loops correctly',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 14400000),
    duration: 45.7,
    assertions: [],
  },
  {
    id: 'tc-splash-7',
    name: 'Responsive Layout Breakpoints',
    description: 'Verify splash page adapts to all screen sizes',
    steps: createSteps([
      'Load splash page at 1920px width',
      'Verify desktop layout',
      'Resize to 1024px (tablet)',
      'Verify tablet layout adjustments',
      'Resize to 768px',
      'Verify navigation collapses',
      'Resize to 375px (mobile)',
      'Verify mobile-first layout',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 18000000),
    duration: 52.3,
    assertions: [],
  },
  {
    id: 'tc-splash-8',
    name: 'Newsletter Signup Form',
    description: 'Test email newsletter subscription flow',
    steps: createSteps([
      'Scroll to newsletter section',
      'Enter invalid email format',
      'Verify validation error',
      'Enter valid email address',
      'Click Subscribe button',
      'Verify success message',
      'Check for duplicate submission prevention',
    ]),
    status: 'passed',
    lastRun: new Date(Date.now() - 21600000),
    duration: 19.4,
    assertions: [],
  },
];

export const mockProjects: Project[] = [
  {
    id: 'proj-1',
    name: 'New Feature on Cart Page',
    description: 'Q1 2026 cart page enhancements including improved UX for quantity updates, promo codes, and save for later functionality',
    summary: 'This project focuses on enhancing the cart experience by improving quantity update flows, implementing robust promo code functionality, adding a "Save for Later" feature, and ensuring cart persistence across sessions. The goal is to reduce cart abandonment by 15% and improve conversion rates.',
    quarter: 'Q1 2026',
    testCases: cartPageTestCases,
    members: createMembers(),
    createdAt: new Date('2025-10-15'),
    lastUpdated: new Date(Date.now() - 3600000),
    status: 'active',
    links: {
      prd: 'https://docs.amazon.com/prd/cart-enhancements-q1-2026',
      figma: 'https://figma.com/file/cart-page-redesign',
    },
    scheduledRun: {
      nextRun: new Date(Date.now() + 3600000 * 2),
      frequency: 'daily',
      enabled: true,
    },
  },
  {
    id: 'proj-2',
    name: 'Integrated Signup Flow Enhancement',
    description: 'Q2 2026 improvements to customer onboarding including social login, accessibility, and mobile optimization',
    summary: 'Comprehensive overhaul of the signup flow to improve conversion rates and accessibility. Key features include Google and Apple OAuth integration, WCAG 2.1 AA compliance, mobile-first responsive design, and streamlined email verification. Target: 25% improvement in signup completion rates.',
    quarter: 'Q2 2026',
    testCases: signupFlowTestCases,
    members: [
      { id: 'm1', name: 'Sarah Chen', email: 'sarah.chen@amazon.com', role: 'owner' },
      { id: 'm6', name: 'Alex Martinez', email: 'alex.m@amazon.com', role: 'edit' },
      { id: 'm7', name: 'Priya Patel', email: 'priya.p@amazon.com', role: 'view' },
    ],
    createdAt: new Date('2025-11-01'),
    lastUpdated: new Date(Date.now() - 7200000),
    status: 'active',
    links: {
      prd: 'https://docs.amazon.com/prd/signup-flow-q2-2026',
      figma: 'https://figma.com/file/signup-redesign',
    },
    scheduledRun: {
      nextRun: new Date(Date.now() + 3600000 * 8),
      frequency: 'weekly',
      enabled: true,
    },
  },
  {
    id: 'proj-3',
    name: 'Splashpage Enhancements',
    description: 'Homepage splash page improvements including performance optimization, pricing toggle, and responsive design',
    summary: 'Performance-focused redesign of the homepage splash page. Key objectives include achieving LCP under 2.5s, implementing a monthly/annual pricing toggle with smooth animations, adding hero carousel functionality, and ensuring seamless responsive behavior across all device sizes.',
    quarter: 'Q1 2026',
    testCases: splashPageTestCases,
    members: [
      { id: 'm1', name: 'Sarah Chen', email: 'sarah.chen@amazon.com', role: 'edit' },
      { id: 'm8', name: 'Jordan Lee', email: 'jordan.l@amazon.com', role: 'owner' },
      { id: 'm4', name: 'David Kim', email: 'david.kim@amazon.com', role: 'view' },
      { id: 'm9', name: 'Rachel Green', email: 'rachel.g@amazon.com', role: 'view' },
    ],
    createdAt: new Date('2025-09-20'),
    lastUpdated: new Date(Date.now() - 1800000),
    status: 'active',
    links: {
      prd: 'https://docs.amazon.com/prd/splashpage-q1-2026',
      figma: 'https://figma.com/file/homepage-splash',
    },
    scheduledRun: {
      nextRun: new Date(Date.now() + 3600000 * 24),
      frequency: 'daily',
      enabled: false,
    },
  },
];

export const getProjectStats = (project: Project) => {
  const totalTests = project.testCases.length;
  const passedTests = project.testCases.filter(tc => tc.status === 'passed').length;
  const failedTests = project.testCases.filter(tc => tc.status === 'failed').length;
  const runningTests = project.testCases.filter(tc => tc.status === 'running').length;
  const pendingTests = project.testCases.filter(tc => tc.status === 'pending').length;
  
  return {
    totalTests,
    passedTests,
    failedTests,
    runningTests,
    pendingTests,
    successRate: totalTests > 0 ? (passedTests / totalTests) * 100 : 0,
  };
};
